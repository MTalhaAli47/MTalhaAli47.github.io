<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Secure Chat ‚Äî Full Visual Simulation</title>
<style>
  :root{
    --bg:#071029;
    --panel:#0f1724;
    --accent:#4fd1c5;
    --accent-2:#60a5fa;
    --muted:#9aa6b2;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{
    background: radial-gradient(1200px 600px at 10% 10%, rgba(96,165,250,0.06), transparent),
                radial-gradient(900px 500px at 90% 90%, rgba(79,209,197,0.04), transparent),
                var(--bg);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:18px;
    box-sizing:border-box;
  }

  header { text-align:center; margin-bottom:12px; }
  h1{margin:6px 0;font-weight:700;color:var(--accent-2);font-size:22px}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  .controls {display:flex; gap:8px; justify-content:center; margin:14px 0; flex-wrap:wrap;}
  .btn {
    background: linear-gradient(180deg,var(--accent) 0%, var(--accent-2) 100%);
    color:#031124;
    border: none;
    padding:10px 14px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
    box-shadow: 0 6px 18px rgba(96,165,250,0.12), inset 0 -2px 0 rgba(0,0,0,0.08);
  }
  .btn.ghost {
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:var(--muted);
    box-shadow:none;
  }
  .layout {
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:18px;
    max-width:1200px;margin:0 auto;
  }

  /* Left: diagram */
  .canvas {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:18px;border-radius:14px; box-shadow: 0 8px 40px rgba(2,6,23,0.6);
    width:1100px; height:600px; /* FIXED SIZE */
    position:relative; overflow:hidden;
  }

  /* Nodes */
  .node {
    width:170px;
    padding:14px;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    text-align:center;
    position:absolute;
    z-index:6;
    color:#e8f6ff;
  }
  .node .title {display:block;font-weight:700;margin-top:8px;font-size:15px}
  .node .sub {display:block;margin-top:6px;color:var(--muted);font-size:12px}

  /* CA at top center */
  #node-ca { left: calc(50% - 110px); top:28px; width:220px; padding:18px; }
  /* Client & Server lower left/right */
  #node-client { left: 100px; bottom: 60px; }
  #node-server { right: 100px; bottom: 60px; }

  /* Certificate badges */
  .cert {
    display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border:1px solid rgba(255,255,255,0.03);
    font-size:13px; color:var(--muted);
  }

  /* svg paths overlay */
  .svg-layer { position:absolute; inset:0; z-index:3; pointer-events:none; }

  /* moving token styles */
  .token {
    position:absolute; z-index:8; width:44px; height:44px; display:flex;align-items:center;justify-content:center;
    font-size:20px; border-radius:10px; background:var(--glass); border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 8px 30px rgba(2,6,23,0.6);
    opacity:0; transform:translate(-50%,-50%) scale(0.9);
    transition: all 0.6s cubic-bezier(.2,.9,.3,1);
  }
  .token.show { opacity:1; transform:translate(-50%,-50%) scale(1); }

  /* right panel logs */
  .panel {
    padding:14px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008)); border:1px solid rgba(255,255,255,0.03);
    height:600px; overflow:auto;
  }
  .step {
    padding:8px 10px; margin-bottom:8px; border-radius:10px; background:rgba(255,255,255,0.01);
    border-left:3px solid rgba(255,255,255,0.02);
  }
  .step h4{margin:0;font-size:14px;color:var(--accent-2);}
  .step p{margin:6px 0 0 0;color:var(--muted);font-size:13px}

  /* AES & RSA visuals */
  .aes-vis, .rsa { display:flex; gap:8px; align-items:center; justify-content:center; margin-top:12px; }
  .aes-item, .hash, .signature { padding:10px 12px; border-radius:10px; min-width:100px; text-align:center; font-size:13px; border:1px solid rgba(255,255,255,0.03); background:rgba(255,255,255,0.01); color:var(--muted) }
  .aes-arrow { font-size:20px; color:var(--muted) }
</style>
</head>
<body>

<header>
  <h1>Secure Chat ‚Äî Full Crypto Visualization</h1>
  <p class="lead">CA ‚Üí Client/Server ‚Üí DH ‚Üí AES ‚Üí RSA. Step by step visual demo.</p>
</header>

<div class="controls">
  <button class="btn" onclick="stepGenerateCA()">Generate CA + Certs</button>
  <button class="btn" onclick="stepExchangeCerts()">Exchange Certificates</button>
  <button class="btn" onclick="stepDH()">Diffie‚ÄìHellman (DH)</button>
  <button class="btn" onclick="stepAES()">AES Demo</button>
  <button class="btn" onclick="stepRSA()">RSA Demo</button>
  <button class="btn ghost" onclick="playFullSequence()">Play Full Sequence</button>
  <button class="btn ghost" onclick="resetAll()">Reset</button>
</div>

<main class="layout">
  <section class="canvas" id="canvas">
    <!-- Nodes -->
    <div id="node-ca" class="node">
      <div style="font-size:28px">üèõÔ∏è</div>
      <span class="title">Root CA</span>
      <span class="sub">RSA 4096 ‚Äî Self-signed</span>
      <div style="margin-top:10px; display:flex;gap:8px;justify-content:center;">
        <div class="cert">ü™™ CA Cert</div>
      </div>
    </div>

    <div id="node-client" class="node">
      <div style="font-size:26px">üíª</div>
      <span class="title">Client</span>
      <span class="sub">client.example</span>
      <div style="margin-top:10px; display:flex;gap:8px;justify-content:center;">
        <div class="cert" id="client-cert">‚Äî</div>
      </div>
    </div>

    <div id="node-server" class="node">
      <div style="font-size:26px">üñ•Ô∏è</div>
      <span class="title">Server</span>
      <span class="sub">server.example</span>
      <div style="margin-top:10px; display:flex;gap:8px;justify-content:center;">
        <div class="cert" id="server-cert">‚Äî</div>
      </div>
    </div>

    <!-- SVG overlay -->
    <svg class="svg-layer" id="svg" viewBox="0 0 1100 600" xmlns="http://www.w3.org/2000/svg">
      <path id="path-ca-client" d="" stroke="#60a5fa" stroke-width="3" fill="none" stroke-linecap="round" opacity="0.2"/>
      <path id="path-ca-server" d="" stroke="#4fd1c5" stroke-width="3" fill="none" stroke-linecap="round" opacity="0.2"/>
      <path id="path-client-server" d="" stroke="#ffd166" stroke-width="2" fill="none" stroke-linecap="round" opacity="0.15"/>
    </svg>

    <!-- Tokens -->
    <div id="token-cert-ca-client" class="token">ü™™</div>
    <div id="token-cert-ca-server" class="token">ü™™</div>
    <div id="token-key-client-server" class="token">üîë</div>
    <div id="token-aes" class="token">üîê</div>
    <div id="token-rsa" class="token">‚úçÔ∏è</div>
  </section>

  <aside class="panel" id="log">
    <div class="step">
      <h4>Start</h4>
      <p>Press buttons to visualize each step of secure communication.</p>
    </div>
  </aside>
</main>

<footer>
  <small>Demo: CA issues certs ‚Üí DH ‚Üí AES ‚Üí RSA signature. Fully animated.</small>
</footer>

<script>
const q=id=>document.getElementById(id);
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}
function log(title,text){
  const el=document.createElement('div'); el.className='step';
  el.innerHTML=`<h4>${title}</h4><p>${text}</p>`; q('log').prepend(el);
}

// Path updates
function updatePaths(){
  const pCA={x:550,y:80}, pCL={x:185,y:540}, pSV={x:845,y:540};
  q('path-ca-client').setAttribute('d',`M${pCA.x} ${pCA.y} C${pCA.x} 260, ${pCL.x} 360, ${pCL.x} ${pCL.y}`);
  q('path-ca-server').setAttribute('d',`M${pCA.x} ${pCA.y} C${pCA.x} 260, ${pSV.x} 360, ${pSV.x} ${pSV.y}`);
  q('path-client-server').setAttribute('d',`M${pCL.x} ${pCL.y} C${pCL.x} 480, ${pSV.x} 480, ${pSV.x} ${pSV.y}`);
}
updatePaths();

// Token animation
async function moveTokenAlongPath(tokenEl, pathEl, duration=900){
  const path=pathEl;
  const length=path.getTotalLength();
  tokenEl.style.opacity=1;
  tokenEl.classList.add('show');
  return new Promise(resolve=>{
    let start=null;
    function step(ts){
      if(!start) start=ts;
      const t=Math.min(1,(ts-start)/duration);
      const e=t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
      const pt=path.getPointAtLength(e*length);
      tokenEl.style.left=pt.x+'px';
      tokenEl.style.top=pt.y+'px';
      if(t<1) requestAnimationFrame(step);
      else {tokenEl.classList.remove('show'); tokenEl.style.opacity=0; resolve();}
    }
    requestAnimationFrame(step);
  });
}

// Steps
async function stepGenerateCA(){
  log('CA Generated','Root CA issued certificates.');
  await moveTokenAlongPath(q('token-cert-ca-client'), q('path-ca-client'));
  q('client-cert').textContent='ü™™ client_cert.pem';
  await moveTokenAlongPath(q('token-cert-ca-server'), q('path-ca-server'));
  q('server-cert').textContent='ü™™ server_cert.pem';
}

async function stepExchangeCerts(){
  log('Certificates Exchange','Client and Server exchange certs.');
  await moveTokenAlongPath(q('token-key-client-server'), q('path-client-server'));
  log('Mutual Validation','Certificates validated successfully.');
}

async function stepDH(){
  log('Diffie‚ÄìHellman Key Exchange','Client & Server establish shared secret.');
  await moveTokenAlongPath(q('token-key-client-server'), q('path-client-server'));
  log('DH Complete','Shared key ready for AES.');
}

async function stepAES(){
  log('AES Encryption','Client encrypts message with AES key.');
  await moveTokenAlongPath(q('token-aes'), q('path-client-server'));
  log('AES Sent','Server receives AES-encrypted message.');
}

async function stepRSA(){
  log('RSA Signing','Server signs message hash with private key.');
  await moveTokenAlongPath(q('token-rsa'), q('path-client-server'));
  log('RSA Verified','Client verifies signature with Server public key.');
}

async function playFullSequence(){
  await stepGenerateCA();
  await sleep(300);
  await stepExchangeCerts();
  await sleep(300);
  await stepDH();
  await sleep(300);
  await stepAES();
  await sleep(300);
  await stepRSA();
}

function resetAll(){
  q('client-cert').textContent='‚Äî';
  q('server-cert').textContent='‚Äî';
  ['token-cert-ca-client','token-cert-ca-server','token-key-client-server','token-aes','token-rsa'].forEach(id=>{q(id).style.opacity=0;});
  log('Reset','Visualization reset.');
}
</script>
</body>
</html>
